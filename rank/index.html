<html lang="zh"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="description" content="专注于分享自制书源与阅读资源的网站，涵盖小说、文学、科技等多种类型，并保持持续更新；除书源外，还提供订阅源、听书引擎等配套内容，方便用户一站式获取最新最全的开源阅读资源"/><title>阅读排行 - 明月书阁 - 明月照大江发布页</title><link rel="icon" href="/img/favicon.ico"/>
<link rel="stylesheet" href="/css/style.css">

<link rel="stylesheet" href="/css/helpers.css">

<script src="/js/clipboard/clipboard.min.js"></script>


<script src="/js/bootstrap.js"></script>

<script>Theme.counter = {
  register: function() {
    request("/api/visit" + '/?page=' + encodeURI(window.location.href), {
      method: "GET"
    })
      .then(counter => {
        for (const key in counter) {
          const dom = document.getElementById(key);
          if (dom) {
            dom.innerText = counter[key];
          }
        }
      })
      .catch(err => {
        console.error("Fetching visit count failed.", err);
      });
  }
};
</script></head><body><div class="loading-wrapper" data-loading="data-loading"><div class="loading"><span></span><span></span><span></span></div></div><div class="page" data-filter="data-filter"><div class="head" data-show="data-show"><header class="head-header"><div class="head-author"><a class="head-author-link" href="/">明月书阁</a></div><div class="head-right"><button class="bar-wrap" id="bar-wrap-toggle" title="菜单按钮"><span class="bar"></span><span class="bar"></span><span class="bar"></span></button><div class="head-item"><a class="search-button head-item-link"><span>搜索</span>
<i class="icon icon-search"></i></a></div><div class="head-item"><a class="head-item-link" href="/activities/">动态</a><a class="head-item-link" href="/rank/">排行</a><a class="head-item-link" href="/download/">下载</a><a class="head-item-link" href="/about/">关于</a></div></div></header>
<div class="menubar-head" id="menubar"><ul class="menubar-ul"><li class="menubar-item"><i class="icon icon-chevron-right"></i>
<a class="menubar-link" href="/categories/%E5%85%AC%E5%91%8A/">公告</a></li><li class="menubar-item"><i class="icon icon-chevron-right"></i>
<a class="menubar-link" href="/categories/%E4%B9%A6%E6%BA%90/">书源</a></li><li class="menubar-item"><i class="icon icon-chevron-right"></i>
<a class="menubar-link" href="/categories/%E8%AE%A2%E9%98%85%E6%BA%90/">订阅源</a></li><li class="menubar-item"><i class="icon icon-chevron-right"></i>
<a class="menubar-link" href="/categories/%E4%B9%A6%E6%BA%90%E5%90%88%E9%9B%86/">书源合集</a></li><li class="menubar-item"><i class="icon icon-chevron-right"></i>
<a class="menubar-link" href="/categories/%E6%9C%97%E8%AF%BB%E5%BC%95%E6%93%8E/">朗读引擎</a></li><li class="menubar-item"><i class="icon icon-chevron-right"></i>
<a class="menubar-link" href="/categories/%E5%A5%BD%E4%B9%A6%E6%8E%A8%E8%8D%90/">好书推荐</a></li><li class="menubar-item"><i class="icon icon-chevron-right"></i>
<a class="menubar-link" href="/categories/%E5%85%B6%E4%BB%96%E8%B5%84%E6%BA%90/">其他资源</a></li><li class="menubar-item"><i class="icon icon-tags"></i>
<a class="menubar-link" href="/tags">Tags</a></li><li class="menubar-item" data-border="data-border"></li><li class="menubar-item"><a class="menubar-link" href="/activities/"><span>动态</span></a></li><li class="menubar-item"><a class="menubar-link" href="/rank/"><span>排行</span></a></li><li class="menubar-item"><a class="menubar-link" href="/download/"><span>下载</span></a></li><li class="menubar-item"><a class="menubar-link" href="/about/"><span>关于</span></a></li></ul><div class="menu-search-box search-button"><div>搜索</div>
<i class="icon icon-search"></i></div></div></div><div class="main"><div class="about"><div id="site-rank">
  <h2>阅读排行</h2>
  <div id="rank-summary" class="rank-summary">
    <div class="rank-card">
      <div class="label">总阅读量</div>
      <div class="value" data-key="total">-</div>
    </div>
    <div class="rank-card">
      <div class="label">本月阅读量</div>
      <div class="value" data-key="month">-</div>
    </div>
    <div class="rank-card">
      <div class="label">本周阅读量</div>
      <div class="value" data-key="week">-</div>
    </div>
    <div class="rank-card">
      <div class="label">今日阅读量</div>
      <div class="value" data-key="day">-</div>
    </div>
  </div>
  <div id="rank-container">
    <p>加载中...</p>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', async function () {
  const summaryEl = document.getElementById('rank-summary');
  const listEl = document.getElementById('rank-container');

  try {
    const [rankData, contentData] = await Promise.all([
      fetchJson('/api/rank'),
      fetchContentJson()
    ]);

    renderSummary(summaryEl, rankData && rankData.summary);

    const posts = extractPosts(contentData);
    const postMap = new Map();
    posts.forEach(post => {
      const path = normalizePath(post.path || '');
      if (path) {
        postMap.set(path, post);
      }
    });

    const ranked = (rankData.pages || [])
      .map(item => {
        const path = normalizePath(item.path || '');
        const post = postMap.get(path);
        if (!post) return null;
        return {
          path,
          pv: Number(item.pv) || 0,
          title: post.title || '无标题',
          author: post.author || '未知',
          date: post.date || ''
        };
      })
      .filter(Boolean)
      .sort((a, b) => b.pv - a.pv)
      .slice(0, 50);

    if (!ranked.length) {
      listEl.innerHTML = '<p>暂无排行数据。</p>';
      return;
    }

    listEl.innerHTML = '';
    ranked.forEach((item, index) => {
      const safeTitle = escapeHtml(item.title);
      const safeAuthor = escapeHtml(item.author);
      const safeDate = formatDate(item.date);
      const metaParts = [];
      if (safeAuthor) metaParts.push(safeAuthor);
      if (safeDate) metaParts.push(safeDate);
      const metaText = metaParts.length ? ` · ${metaParts.join(' · ')}` : '';
      const permalink = item.path;
      const countText = formatNumber(item.pv);

      listEl.insertAdjacentHTML('beforeend', `
        <div class="activity-item">
          <div class="activity-time">#${index + 1} · <span class="rank-count">${countText}</span> 次</div>
          <div class="activity-content">
            <i class="fas fa-fire"></i>
            <span class="activity-text"><a href="${permalink}">${safeTitle}</a><span class="rank-meta">${metaText}</span></span>
          </div>
        </div>
      `);
    });
  } catch (err) {
    console.error('加载排行失败:', err);
    listEl.innerHTML = '<p>加载排行失败，请稍后重试。</p>';
  }
});

async function fetchJson(url) {
  const response = await fetch(url, { headers: { 'X-Requested-With': 'XMLHttpRequest' } });
  if (!response.ok) {
    throw new Error(`请求失败: ${response.status}`);
  }
  return response.json();
}

async function fetchContentJson() {
  try {
    return await fetchJson('/cont.json');
  } catch (err) {
    return await fetchJson('/content.json');
  }
}

function extractPosts(data) {
  if (Array.isArray(data)) return data;
  if (Array.isArray(data.posts)) return data.posts;
  return [];
}

function normalizePath(input) {
  let path = (input || '').trim();
  if (!path) return '/';
  if (!path.startsWith('/')) path = `/${path}`;
  path = path.replace(/\/{2,}/g, '/');
  const hasExt = /\.[a-zA-Z0-9]+$/.test(path);
  if (path !== '/' && !hasExt && !path.endsWith('/')) path += '/';
  return path;
}

function formatNumber(value) {
  const numberValue = Number(value) || 0;
  return numberValue.toLocaleString('zh-CN');
}

function formatDate(dateStr) {
  if (!dateStr) return '';
  const date = new Date(dateStr);
  if (Number.isNaN(date.getTime())) return '';
  const y = date.getFullYear();
  const m = String(date.getMonth() + 1).padStart(2, '0');
  const d = String(date.getDate()).padStart(2, '0');
  return `${y}-${m}-${d}`;
}

function escapeHtml(value) {
  return String(value)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#39;');
}
</script>

<style>
#site-rank {
  max-width: 900px;
  margin: 2em auto;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
}

#site-rank h2 {
  font-size: 1.8em;
  margin-bottom: 1em;
  text-align: center;
  color: #ddd;
}

.rank-summary {
  display: grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: 12px;
  margin-bottom: 1.5em;
}

.rank-card {
  background: #1e1e1e;
  border: 1px solid #333;
  border-radius: 12px;
  padding: 0.9em 1em;
  text-align: center;
}

.rank-card .label {
  color: #888;
  font-size: 0.9em;
}

.rank-card .value {
  margin-top: 6px;
  font-size: 1.4em;
  font-weight: 600;
  color: #79b8ff;
}

.activity-item {
  background: #1e1e1e;
  border: 1px solid #333;
  border-radius: 12px;
  padding: 1em 1.2em;
  margin-bottom: 1em;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.activity-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(0,0,0,0.5);
}

.activity-time {
  font-size: 0.85em;
  color: #888;
  margin-bottom: 0.5em;
}

.activity-content {
  display: flex;
  align-items: center;
  gap: 10px;
}

.activity-content i {
  color: #ffb454;
  font-size: 1.2em;
  flex-shrink: 0;
}

.activity-text {
  font-size: 1em;
  color: #ccc;
}

.activity-text a {
  color: #79b8ff;
  font-weight: 600;
  text-decoration: none;
  transition: color 0.2s;
}

.activity-text a:hover {
  color: #cdd9e5;
  text-decoration: underline;
}

.rank-meta {
  color: #888;
  font-size: 0.9em;
  margin-left: 6px;
}

.rank-count {
  color: #79b8ff;
  font-weight: 600;
}

@media (max-width: 768px) {
  .rank-summary {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
}
</style>
</div></div><footer class="footer-nav"><div class="footer"><div class="back-top" id="back-top" title="Back to top"><i class="icon icon-chevron-bar-up"></i></div><div class="footer-content"><div class="footer-links"><div class="footer-links-column"><p><a title="源仓库" target="_blank" rel="noopener" href="https://www.yckceo.com/">源仓库</a></p><p><a title="阅读下载" href="/download/">阅读下载</a></p><p><a title="洛娅橙发布页" target="_blank" rel="noopener" href="https://洛娅橙.duckdns.org/">洛娅橙发布页</a></p></div><div class="footer-links-column"><p><a title="喵公子订阅" target="_blank" rel="noopener" href="https://yuedu.miaogongzi.net/">喵公子订阅</a></p><p><a title="遇知发布页" target="_blank" rel="noopener" href="https://yuzhi.ip-ddns.com/">遇知发布页</a></p><p><a title="小寒发布页" target="_blank" rel="noopener" href="https://qyyuapi.com/">小寒发布页</a></p></div><div class="footer-links-column"><p><a title="天天的小站" target="_blank" rel="noopener" href="https://blog.ttxz.eu.org/">天天的小站</a></p><p><a title="活力宝小窝" target="_blank" rel="noopener" href="https://hlb.leleosd.top/">活力宝小窝</a></p><p><a title="荼丛の小破站" target="_blank" rel="noopener" href="https://tucong.vip/">荼丛の小破站</a></p></div><div class="footer-links-column"><p><a title="浅殇番茄" target="_blank" rel="noopener" href="https://fqphp.gxom.cn/">浅殇番茄</a></p><p><a title="寻道云海" target="_blank" rel="noopener" href="https://ys.66ds.de/">寻道云海</a></p></div></div><div><span id="site_pv">?</span>
PV
<span id="site_uv">?</span>
UV</div>

Copyright &copy;
<span class="time-divide">-</span>2025
明月照大江.

Power by
<a href="https://hexo.io/" target="_blank" rel="external nofollow">Hexo</a>
and
<a href="https://github.com/Cerallin/hexo-theme-yuzu" target="_blank" rel="external nofollow" title="v3.2.5">Theme Yuzu</a>.</div></div></footer>
<script>window.config = {
  url_root: '/',
  meta_path: 'meta.json',
};
</script>
<script src="/js/theme/back-to-top.js"></script>


<script src="/js/theme/clipboard.js"></script>


<script src="/js/theme/loading.js"></script>


<script src="/js/theme/navbar.js"></script>

<script src="/js/theme/search.js"></script>

<script src="/js/theme/toc.js"></script>
<script>window.onload = function () {
  for (const moduleName in Theme) {
    const module = Theme[moduleName];
    module.register();
  }
};</script></div><div class="search-modal" id="search-modal"><div class="card"><div class="card-head"><div class="search-box"><input class="search-input" id="search-input" placeholder="搜索"/><div class="search-button" id="search-button"><div class="icon icon-search"></div></div></div><div class="close-button"><div class="icon icon-x"></div></div></div><div class="card-body"><div class="search-count">共<span id="search-count-num">0</span>条搜索结果。</div><div class="search-result" id="search-result"></div></div></div></div></body></html>