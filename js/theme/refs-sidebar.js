(function(){"use strict";Theme.refsSidebar={register(){const e=document.getElementById("refs");if(!e)return;let t=null,r=null;const n=Math.max(30,1.5*parseFloat(getComputedStyle(document.documentElement).fontSize)),i=e=>{t?.hasAttribute("data-open")&&(t.contains(e.target)||e.target.closest('a[href^="#ref-"], a[role="doc-biblioref"][href^="#"]')||(l(),document.removeEventListener("click",i)))},o=()=>{const e=document.documentElement.clientWidth,t=document.querySelector("article.post")||document.querySelector(".post")||document.querySelector(".main"),r=.45*e;if(!t)return`${r}px`;const i=e-t.getBoundingClientRect().right-n,o=i>=350?i:350;return`${Math.min(o,r)}px`},a=n=>{(()=>{if(t)return;t=document.createElement("div"),t.className="refs-sidebar",t.setAttribute("aria-label","参考文献"),t.innerHTML='\n          <div class="refs-sidebar-header">\n            <h2 class="refs-sidebar-title">参考文献</h2>\n            <button type="button" class="refs-sidebar-close" aria-label="关闭">×</button>\n          </div>\n          <div class="refs-sidebar-content"></div>\n        ',r=t.querySelector(".refs-sidebar-content");const n=e.cloneNode(!0);n.removeAttribute("id");const i=e.querySelectorAll(".csl-entry"),a=n.querySelectorAll(".csl-entry");i.forEach((e,t)=>{a[t]&&(a[t].setAttribute("data-ref-id",e.id),a[t].removeAttribute("id"))}),r.appendChild(n),document.body.appendChild(t),t.querySelector(".refs-sidebar-close").addEventListener("click",l),t.addEventListener("click",e=>{e.target===t&&l()}),window.addEventListener("resize",()=>{t.hasAttribute("data-open")&&(t.style.maxWidth=o())})})(),t.style.maxWidth=o(),requestAnimationFrame(()=>{t.setAttribute("data-open","")});r.querySelectorAll(".csl-entry[data-refs-highlight]").forEach(e=>e.removeAttribute("data-refs-highlight"));const a=n?r.querySelector(`[data-ref-id="${n}"]`):null;a&&(a.setAttribute("data-refs-highlight",""),a.scrollIntoView({block:"start",behavior:"auto"})),setTimeout(()=>document.addEventListener("click",i),0)},l=()=>{t&&(t.removeAttribute("data-open"),document.removeEventListener("click",i))};document.querySelectorAll('a[href^="#ref-"], a[role="doc-biblioref"][href^="#"]').forEach(e=>{e.addEventListener("click",t=>{const r=e.getAttribute("href");r&&"#"!==r&&r.startsWith("#ref-")&&(t.preventDefault(),a(r.slice(1)))})})}}}).call(this);